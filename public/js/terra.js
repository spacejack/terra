!function o(i,u,l){function s(t,e){if(!u[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var n=u[t]={exports:{}};i[t][0].call(n.exports,function(e){return s(i[t][1][e]||e)},n,n.exports,o,i,u,l)}return u[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)s(l[e]);return s}({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=e("./gmath"),f=5;function r(r,n,o,i,u){var l=Date.now(),s=c.roundFrac(n,f).toString();r.style.opacity=s,requestAnimationFrame(function e(){var t=Date.now()-l;if(i<=t)r.style.opacity=c.roundFrac(o,f).toString(),u&&u();else{var a=c.roundFrac(n+t/i*(o-n),f).toString();a!==s&&(r.style.opacity=a,s=a),requestAnimationFrame(e)}})}a.fade=r,a.fadeIn=function(e,t,a){r(e,0,1,t,a)},a.fadeOut=function(e,t,a){r(e,1,0,t,a)}},{"./gmath":6}],2:[function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};Object.defineProperty(a,"__esModule",{value:!0});var f=e("./util"),d=r(e("./loader")),h=n(e("./input")),p=n(e("./anim")),v=n(e("./fullscreen")),y=n(e("./browser")),g=r(e("./world")),m={mobile:{blades:2e4,depth:50,antialias:!1},laptop:{blades:4e4,depth:65,antialias:!1},desktop:{blades:84e3,depth:85,antialias:!0},desktop2:{blades:25e4,depth:125,antialias:!0},gamerig:{blades:5e5,depth:175,antialias:!0}};a.default=function(){var n,o,a=f.$e("app_canvas_container"),i=640,u=480,r=v.is();function e(e){var t=Math.floor(90*e);f.$e("loading_bar").style.width=t+"%"}function t(e){f.$e("loading_text").textContent=e}function l(e){n=e,f.$e("loading_bar").style.width="100%",f.$e("loading_text").innerHTML="&nbsp;",setTimeout(function(){f.$e("loading_bar_outer").style.visibility="hidden",f.$e("config_block").style.visibility="visible",f.$e("btn_start").onclick=function(){p.fadeOut(f.$e("loading_block"),80,function(){f.$e("loading_block").style.display="none",r||(f.$e("title_bar").style.display="block"),f.$e("btn_fullscreen").onclick=function(){v.toggle(f.$e("app_container"))},f.$e("btn_restart").onclick=function(){document.location.reload()},function(){if(f.$i("chk_audio").checked){var e=f.$e("chopin");e.loop=!0,e.play()}h.init();var t=+f.$i("inp_blades").value,a=+f.$i("inp_depth").value,r=!!f.$i("chk_antialias").checked;o=g.default(n,t,a,i,u,r),s()}()})}},10)}function s(){o.doFrame(),requestAnimationFrame(s)}function c(){if(i=a.clientWidth,u=a.clientHeight,o)o.resize(i,u);else{var e=f.$e("app_canvas");e.width=i,e.height=u}var t=v.is();t!==r&&(f.$e("title_bar").style.display=t?"none":"block",r=t)}return{run:function(){return f.$e("app_canvas_container")?f.detectWebGL()?(c(),d.default().load({text:[{name:"grass.vert",url:"shader/grass.vert.glsl"},{name:"grass.frag",url:"shader/grass.frag.glsl"},{name:"terrain.vert",url:"shader/terrain.vert.glsl"},{name:"terrain.frag",url:"shader/terrain.frag.glsl"},{name:"water.vert",url:"shader/water.vert.glsl"},{name:"water.frag",url:"shader/water.frag.glsl"}],images:[{name:"heightmap",url:"data/heightmap.jpg"},{name:"noise",url:"data/noise.jpg"}],textures:[{name:"grass",url:"data/grass.jpg"},{name:"terrain1",url:"data/terrain1.jpg"},{name:"terrain2",url:"data/terrain2.jpg"},{name:"skydome",url:"data/skydome.jpg"},{name:"skyenv",url:"data/skyenv.jpg"}]},l,e,t),function(){var e=y.isMobile.any?"mobile":"desktop",t=m[e],n=f.$i("sel_devicepower");n.value=e;var o=f.$i("inp_blades");o.value=t.blades.toString();var i=f.$i("inp_depth");i.value=t.depth.toString(),f.$i("chk_antialias").checked=t.antialias,f.$i("chk_fullscreen").checked=!1,f.$i("chk_fullscreen").onchange=function(){v.toggle(f.$e("app_container"))},n.onchange=function(e){var t=m[n.value],a=t.blades.toString(),r=t.depth.toString();o.value=a,i.value=r,f.$e("txt_blades").textContent=a,f.$e("txt_depth").textContent=r,f.$i("chk_antialias").checked=t.antialias},f.$e("txt_blades").textContent=t.blades.toString(),f.$e("txt_depth").textContent=t.depth.toString(),o.onchange=function(e){f.$e("txt_blades").textContent=o.value},i.onchange=function(e){f.$e("txt_depth").textContent=i.value}}(),window.addEventListener("resize",c,!1),!0):!(f.$e("loading_text").textContent="WebGL unavailable."):(console.error("app_canvas_container element not found in page"),!1)}}}},{"./anim":1,"./browser":3,"./fullscreen":5,"./input":9,"./loader":10,"./util":19,"./world":22}],3:[function(e,t,a){"use strict";var r,n,o,i,u,l;Object.defineProperty(a,"__esModule",{value:!0}),a.isStandalone=void 0!==navigator.standalone?!!navigator.standalone:window.external&&window.external.msIsSiteMode?!!window.external.msIsSiteMode():window.matchMedia("(display-mode: standalone)").matches,a.isMobile=(r=!!navigator.userAgent.match(/Android/i),n=!!navigator.userAgent.match(/BlackBerry/i),o=!!navigator.userAgent.match(/iPhone|iPad|iPod/i),i=!!navigator.userAgent.match(/Opera Mini/i),u=!!navigator.userAgent.match(/IEMobile/i),l=!!navigator.userAgent.match(/\(Mobile/i),{Android:r,BlackBerry:n,iOS:o,Opera:i,Windows:u,FireFox:l,any:r||n||o||i||u||l})},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){void 0===t&&(t=16);for(var a=new Array(t),r=0,n=0,o=60,e=0;e<t;++e)a[e]=16.66666667,r+=16.66666667;return{update:function(e){return r-=a[n],r+=e,a[n]=e,n=(n+1)%t,o=1e3*t/r},fps:function(){return o.toFixed(1)}}}},{}],5:[function(e,t,a){"use strict";function r(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}Object.defineProperty(a,"__esModule",{value:!0}),a.toggle=function(e){r()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},a.is=r},{}],6:[function(e,t,r){"use strict";function n(e){return 0<e?1:e<0?-1:0}function o(e,t){return(e%t+t)%t}Object.defineProperty(r,"__esModule",{value:!0}),r.PI2=2*Math.PI,r.sign=n,r.roundFrac=function(e,t){var a=Math.pow(10,t);return Math.round((e+1e-9)*a)/a},r.clamp=function(e,t,a){return Math.min(Math.max(e,t),a)},r.pmod=o,r.nrand=function(){return 2*Math.random()-1},r.angle=function(e,t){return o(Math.atan2(t,e),r.PI2)},r.difAngle=function(e,t){var a=o(t,r.PI2)-o(e,r.PI2);return Math.abs(a)<Math.PI?a:a-r.PI2*n(a)},r.dot=function(e,t,a,r){return e*a+t*r}},{}],7:[function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});var c=e("./gmath"),f=e("./vec"),d=r(e("./simplex")),h=4,p=2*(h+1),v=12*h,y=.15,g=2.25,m=3;a.createMesh=function(e){var t={vindex:new Float32Array(2*p*1),shape:new Float32Array(4*e.numBlades),offset:new Float32Array(4*e.numBlades),index:new Uint16Array(v)};!function(e,t,a,r){var n;for(n=0;n<h;++n)e[r++]=t+0,e[r++]=t+1,e[r++]=t+2,e[r++]=t+2,e[r++]=t+1,e[r++]=t+3,t+=2;for(n=0;n<h;++n)e[r++]=a+2,e[r++]=a+1,e[r++]=a+0,e[r++]=a+3,e[r++]=a+1,e[r++]=a+2,a+=2}(t.index,0,p,0),function(e,t,a){for(var r=0;r<t;++r)e[4*r+0]=c.nrand()*a,e[4*r+1]=c.nrand()*a,e[4*r+2]=0,e[4*r+3]=2*Math.PI*Math.random()}(t.offset,e.numBlades,e.radius),function(e,t,a){for(var r=0,n=0;n<t;++n)r=Math.abs(d.default(.03*a[4*n+0],.03*a[4*n+1])),r*=r*r,r*=5,e[4*n+0]=y+Math.random()*y*.5,e[4*n+1]=g+Math.pow(Math.random(),4)*(m-g)+r,e[4*n+2]=0+.3*Math.random(),e[4*n+3]=.05+.3*Math.random()}(t.shape,e.numBlades,t.offset),function(e){for(var t=0;t<e.length;++t)e[t]=t}(t.vindex);var a=new THREE.InstancedBufferGeometry;a.boundingSphere=new THREE.Sphere(new THREE.Vector3(0,0,0),1e4*Math.sqrt(e.radius*e.radius*2)),a.addAttribute("vindex",new THREE.BufferAttribute(t.vindex,1)),a.addAttribute("shape",new THREE.InstancedBufferAttribute(t.shape,4)),a.addAttribute("offset",new THREE.InstancedBufferAttribute(t.offset,4)),a.setIndex(new THREE.BufferAttribute(t.index,1));var r=e.texture;r.wrapS=r.wrapT=THREE.RepeatWrapping;var n=e.heightMap;n.wrapS=n.wrapT=THREE.RepeatWrapping;var o=e.heightMapScale,i=f.Vec3.clone(e.lightDir);i.z*=.5,f.Vec3.normalize(i,i);var u=e.vertScript.replace("%%BLADE_HEIGHT_TALL%%",(1.5*m).toFixed(1)).replace("%%BLADE_SEGS%%",h.toFixed(1)).replace("%%PATCH_SIZE%%",(2*e.radius).toFixed(1)).replace("%%TRANSITION_LOW%%",e.transitionLow.toString()).replace("%%TRANSITION_HIGH%%",e.transitionHigh.toString()),l=new THREE.RawShaderMaterial({uniforms:{lightDir:{type:"3f",value:f.Vec3.toArray(i)},time:{type:"f",value:0},map:{type:"t",value:r},heightMap:{type:"t",value:n},heightMapScale:{type:"3f",value:[o.x,o.y,o.z]},camDir:{type:"3f",value:[1,0,0]},drawPos:{type:"2f",value:[100,0]},fogColor:{type:"3f",value:f.Color.toArray(e.fogColor)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:e.fogFar},grassColor:{type:"3f",value:f.Color.toArray(e.grassColor)},grassFogFar:{type:"f",value:e.grassFogFar},windIntensity:{type:"f",value:e.windIntensity}},vertexShader:u,fragmentShader:e.fragScript,transparent:!0}),s=new THREE.Mesh(a,l);return s.frustumCulled=!1,s},a.update=function(e,t,a,r,n){var o=e.material;o.uniforms.time.value=t;var i=o.uniforms.camDir.value;i[0]=r.x,i[1]=r.y,i[2]=r.z,(i=o.uniforms.drawPos.value)[0]=n.x,i[1]=n.y}},{"./gmath":6,"./simplex":15,"./vec":20}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var g=e("./gmath"),m=e("./vec");function r(){return{i:0,t:0,z:0,n:m.Vec3.create()}}function n(e){var t={cellSize:e.cellSize&&0<e.cellSize?e.cellSize:1,minHeight:"number"==typeof e.minHeight?e.minHeight:0,maxHeight:"number"==typeof e.maxHeight?e.maxHeight:1,xCount:0,yCount:0,xSize:0,ySize:0,heights:new Float32Array(0),faceNormals:new Float32Array(0),vtxNormals:new Float32Array(0)};return e.image?function(e,t){var a,r,n,o=e.width,i=e.height,u=t.maxHeight-t.minHeight;t.xCount=o-1,t.yCount=i-1,t.xSize=t.xCount*t.cellSize,t.ySize=t.yCount*t.cellSize;var l=document.createElement("canvas");l.width=o,l.height=i;var s=l.getContext("2d");s.drawImage(e,0,0,o,i);var c=s.getImageData(0,0,o,i).data,f=new Float32Array(o*i);for(r=0;r<i;++r)for(a=0;a<o;++a)n=c[4*(a+(i-r-1)*o)]/255,f[a+r*o]=t.minHeight+n*u;c=s=l=null,t.heights=f,t.faceNormals=new Float32Array(6*t.xCount*t.yCount),t.vtxNormals=new Float32Array(3*(t.xCount+1)*(t.yCount+1)),d(t),function(e){for(var t=e.vtxNormals,a=e.xCount+1,r=e.yCount+1,n=m.Vec3.create(),o=0,i=Date.now(),u=0;u<r;++u)for(var l=0;l<a;++l)h(e,l,u,n),o=3*(u*a+l),t[o++]=n.x,t[o++]=n.y,t[o++]=n.z;var s=Date.now()-i;console.log("computed "+a*r+" vertex normals in "+s+"ms")}(t)}(e.image,t):(t.xCount=e.xCount&&0<e.xCount?Math.floor(e.xCount):1,t.yCount=e.yCount&&0<e.yCount?Math.floor(e.yCount):1,t.xSize=t.xCount*t.cellSize,t.ySize=e.yCount*t.cellSize,t.heights=e.heights||new Float32Array((t.xCount+1)*(t.yCount+1)),t.faceNormals=new Float32Array(6*t.xCount*t.yCount),t.vtxNormals=new Float32Array(3*(t.xCount+1)*(t.yCount+1)),d(t)),t}function d(e){for(var t=e.cellSize,a=e.xCount,r=e.yCount,n=e.xCount+1,o=e.heights,i=e.faceNormals,u=m.Vec3.create(),l=m.Vec3.create(),s=m.Vec3.create(),c=0,f=Date.now(),d=0;d<r;++d)for(var h=0;h<a;++h){c=6*(h+d*a);var p=h+d*n,v=o[p];u.x=t,u.y=t,u.z=o[p+n+1]-v,l.x=0,l.y=t,l.z=o[p+n]-v,m.Vec3.cross(u,l,s),m.Vec3.normalize(s,s),i[c+0]=s.x,i[c+1]=s.y,i[c+2]=s.z,u.x=t,u.y=0,u.z=o[p+1]-v,l.x=t,l.y=t,l.z=o[p+n+1]-v,m.Vec3.cross(u,l,s),m.Vec3.normalize(s,s),i[c+3]=s.x,i[c+4]=s.y,i[c+5]=s.z}var y=Date.now()-f;console.log("computed "+c+" heightfield face normals in "+y+"ms")}function h(e,t,a,r){var n=e.faceNormals,o=t%e.xCount,i=a%e.yCount,u=3*(i*e.xCount+o)*2;r.x=n[u+0],r.y=n[u+1],r.z=n[u+2],u+=3,r.x+=n[u+0],r.y+=n[u+1],r.z+=n[u+2],o=g.pmod(o-1,e.xCount),u=3*(i*e.xCount+o)*2+3,r.x+=n[u+0],r.y+=n[u+1],r.z+=n[u+2],u=3*((i=g.pmod(i-1,e.yCount))*e.xCount+o)*2,r.x+=n[u+0],r.y+=n[u+1],r.z+=n[u+2],u+=3,r.x+=n[u+0],r.y+=n[u+1],r.z+=n[u+2],o=(o+1)%e.xCount,u=3*(i*e.xCount+o)*2,r.x+=n[u+0],r.y+=n[u+1],r.z+=n[u+2],m.Vec3.normalize(r,r)}a.HInfo=r,function(e){function n(e,t,a,r,n){var o=-e.xSize/2,i=-e.ySize/2;if(t<o||-o<=t||a<i||-i<=a){if(!r)return n.i=-1,n.z=e.minHeight,n.n.x=n.n.y=n.n.z=0,void(n.t=0);t=g.pmod(t-o,e.xSize)+o,a=g.pmod(a-i,e.ySize)+i}var u=e.cellSize,l=e.faceNormals,s=n.n,c=Math.floor((t-o)/u),f=Math.floor((a-i)/u),d=c+f*(e.xCount+1),h=(t-o)%u,p=(a-i)%u,v=c+f*e.xCount;0<p&&h/p<1?(n.t=0,s.x=l[6*v+0],s.y=l[6*v+1],s.z=l[6*v+2]):(n.t=1,s.x=l[6*v+3],s.y=l[6*v+4],s.z=l[6*v+5]),n.i=v,n.z=y(s,e.heights[d],h,p)}e.infoAt=n;var o=r();function y(e,t,a,r){return t-(e.x*a+e.y*r)/e.z}e.heightAt=function(e,t,a,r){return void 0===r&&(r=!1),n(e,t,a,r,o),o.z},e.getPlaneZ=y}(n=n||{}),a.default=n},{"./gmath":6,"./vec":20}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.state={up:0,down:0,left:0,right:0,forward:0,back:0,pitchup:0,pitchdown:0};var a=new Array(256).map(function(e){return!1}),n={};function o(e,t){var a=r.state;37===e?a.left=t:39===e?a.right=t:38===e?a.forward=t:40===e?a.back=t:87===e?a.up=t:83===e?a.down=t:81===e?a.pitchup=t:65===e&&(a.pitchdown=t)}function i(e){if(!a[e.keyCode]){o(e.keyCode,1),a[e.keyCode]=!0;var t=e.keyCode.toString();"function"==typeof n[t]&&n[t]()}}function u(e){a[e.keyCode]&&(a[e.keyCode]=!1,o(e.keyCode,0))}var l=!1;r.init=function(){l||(document.addEventListener("keydown",i,!0),document.addEventListener("keyup",u,!0),l=!0)},r.getKeyState=function(e){return a[e]},r.setKeyPressListener=function(e,t){n[e.toString()]=t}},{}],10:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(){var u,l,s,c,f=!1,d=0,h=0,p=0,v={images:{},text:{},textures:{}};function y(e){console.log("loading "+e.url);var t=new XMLHttpRequest;t.overrideMimeType("*/*"),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(v.text[e.name]=t.responseText,console.log("loaded "+e.name),m()):a("Error "+t.status+" loading "+e.url))},t.open("GET",e.url),t.send()}function g(e){var t=new Image;(v.images[e.name]=t).onload=m,t.onerror=a,t.src=e.url}function m(){h+=1,l&&l(h/d),t()}function a(e){s&&s(e),p+=1,t()}function t(){if(!f)return 1;if(d<=h+p){var e=!p;e&&u&&u(v),c&&c(e),f=!1}return!f}return{load:function(e,t,a,r,n){if(u=t,l=a,s=r,c=n,f=!(p=h=d=0),e.text){d+=e.text.length;for(var o=0;o<e.text.length;++o)y(e.text[o])}if(e.images){d+=e.images.length;for(o=0;o<e.images.length;++o)g(e.images[o])}if(e.textures){d+=e.textures.length;for(o=0;o<e.textures.length;++o)i=e.textures[o],v.textures[i.name]=(new THREE.TextureLoader).load(i.url,m)}var i},getAssets:function(){return v}}}},{}],11:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("./util"),n=!1;a.setText=function(e){r.$e("logger").textContent=e},a.setHtml=function(e){r.$e("logger").innerHTML=e},a.toggle=function(){var e=r.$e("logger");n=!n,e.style.display=n?"inline-block":"none"},a.hide=function(){r.$e("logger").style.display="none",n=!1},a.show=function(){r.$e("logger").style.display="inline-block",n=!0},a.isVisible=function(){return n}},{"./util":19}],12:[function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),r(e("./app")).default().run()},{"./app":2}],13:[function(e,t,a){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};Object.defineProperty(a,"__esModule",{value:!0});var n=e("./util"),o=r(e("./anim")),i=!1;a.default=function(e){var t=n.$e("notification_text");if(t.textContent=e,!i){var a=n.$e("notification");a.style.display="block",a.style.opacity="1.0",i=!0,setTimeout(function(){o.fadeOut(a,1e3,function(){a.style.display="none",t.textContent="",i=!1})},4e3)}}},{"./anim":1,"./util":19}],14:[function(e,t,a){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});var h=e("./gmath"),_=e("./vec"),o=r(e("./input")),i=n(e("./notification")),b=n(e("./heightfield")),u=r(e("./logger")),l=0,E=2.5,C=275,S=.75,F=16,H=-.325,s=1500,A=90,T=.1,R=60,V=5,P=4,k=2,I=4,O=16,$=8,L=2,j=10,D=8,c=40,f=10,d=.5,B=.5,q=Math.PI/4,N=0,W=1,G=2,K=3;a.default=function(p,v){var r=N,n=0,y={pos:_.Vec3.create(0,0,l),vel:_.Vec3.create(0,0,0),dir:_.Vec3.create(1,0,0),yaw:0,yawVel:0,pitch:0,pitchVel:0,roll:0,rollVel:0,floatHeight:0};o.setKeyPressListener(13,function(){e(),r===N?(u.hide(),i.default("Press ENTER to change camera")):r===W?i.default("ARROWS drive, W/S move up/down."):r===G&&(u.show(),i.default("ARROWS move, W/S move up/down, Q/A look up/down"))});var g=_.Vec3.create(),m=_.Vec3.create(),x=_.Vec3.create(),w=_.Vec3.create(),M=_.Vec3.create();function e(){(r=(r+1)%K)===G&&(y.roll=0,y.rollVel=0,y.pitchVel=0,y.yawVel=0)}function z(e,t){t.x=Math.cos(e)*s+Math.sin(e)*s*2,t.y=Math.sin(e)*s+Math.cos(e)*s*2}return{update:function(e){n+=e,r===N?function(e,t){var a=t/1e3;_.Vec3.copy(y.pos,g);var r=y.yaw,n=y.pitch;z(.01*e,y.pos),z(.01*(e+1),x),z(.01*(e+2),w),z(.01*(e+3),M);var o=.3*e;y.pos.z=F+Math.cos(o)*F,y.pitch=H-.25*Math.sin(o+.5*Math.PI),y.yaw=Math.sin(.04*e)*Math.PI*2+.5*Math.PI;var i=Math.max(b.default.heightAt(p,y.pos.x,y.pos.y,!0),v),u=Math.max(b.default.heightAt(p,x.x,x.y,!0),v),l=Math.max(b.default.heightAt(p,w.x,w.y,!0),v),s=Math.max(b.default.heightAt(p,M.x,M.y,!0),v),c=Math.max(Math.max(Math.max(i,u),l),s),f=y.floatHeight<c?c-y.floatHeight:i-y.floatHeight;f<0&&(f*=.25);y.floatHeight+=f*S*a,y.floatHeight<i&&(y.floatHeight=i);y.pos.z+=y.floatHeight+E,m.x=y.pos.x-g.x,m.y=y.pos.y-g.y,m.z=y.pos.z-g.z,y.vel.x=m.x/a,y.vel.y=m.y/a,y.vel.z=m.z/a;var d=y.yaw-r;y.yawVel=d/a;var h=y.pitch-n;y.pitchVel=h/a}(n/1e3,e):r===W?function(e,t){var a=t/1e3,r=0;0<e.left?r=-L:0<e.right&&(r=L);var n=-y.roll*j,o=-h.sign(y.rollVel)*D*Math.abs(y.rollVel);r=r+n+o,y.rollVel+=r*a,y.roll+=y.rollVel*a;var i=-y.roll*P,u=-h.sign(y.yawVel)*Math.abs(Math.pow(y.yawVel,3))*k;y.yawVel+=(i+u)*a,y.yaw+=y.yawVel*a;var l=0;0<e.forward?l=-I:0<e.back&&(l=.5*I);var s=-y.pitch*O,c=-h.sign(y.pitchVel)*$*Math.abs(y.pitchVel);l=l+s+c,y.pitchVel+=l*a,y.pitch+=y.pitchVel*a,_.Vec3.set(g,0,0,0),g.x=-y.pitch*A*Math.cos(y.yaw),g.y=-y.pitch*A*Math.sin(y.yaw);var f=_.Vec2.length(y.vel);m.x=-y.vel.x,m.y=-y.vel.y,_.Vec2.setLength(m,f*T,m),0<e.up&&y.pos.z<C-2?g.z=R:0<e.down&&y.pos.z>E&&(g.z=-R);m.z=-y.vel.z*V,y.vel.x+=(g.x+m.x)*a,y.vel.y+=(g.y+m.y)*a,y.vel.z+=(g.z+m.z)*a,y.pos.x+=y.vel.x*a,y.pos.y+=y.vel.y*a,y.pos.z+=y.vel.z*a;var d=Math.max(b.default.heightAt(p,y.pos.x,y.pos.y,!0),v);y.pos.z<d+E?y.pos.z=d+E:y.pos.z>C&&(y.pos.z=C)}(o.state,e):r===G&&function(e,t){var a=t/1e3;y.yawVel=0,e.left?y.yawVel=d:e.right&&(y.yawVel=-d);y.yaw+=y.yawVel*a,y.pitchVel=0,e.pitchup?y.pitchVel=B:e.pitchdown&&(y.pitchVel=-B);y.pitch+=y.pitchVel*a,y.pitch=h.clamp(y.pitch,-q,q),_.Vec3.set(y.vel,0,0,0),e.forward?(y.vel.x=c*Math.cos(y.yaw),y.vel.y=c*Math.sin(y.yaw)):e.back&&(y.vel.x=-c*Math.cos(y.yaw),y.vel.y=-c*Math.sin(y.yaw));y.pos.x+=y.vel.x*a,y.pos.y+=y.vel.y*a,e.up?y.vel.z=f:e.down&&(y.vel.z=-f);y.pos.z+=y.vel.z*a;var r=Math.max(b.default.heightAt(p,y.pos.x,y.pos.y,!0),v);y.pos.z<r+E?y.pos.z=r+E:y.pos.z>C&&(y.pos.z=C)}(o.state,e);var t=y.dir;t.z=Math.sin(y.pitch);var a=1-Math.abs(t.z);t.x=Math.cos(y.yaw)*a,t.y=Math.sin(y.yaw)*a},state:y,getMode:function(){return r},nextMode:e}}},{"./gmath":6,"./heightfield":8,"./input":9,"./logger":11,"./notification":13,"./vec":20}],15:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=(n.prototype.dot2=function(e,t){return this.x*e+this.y*t},n.prototype.dot3=function(e,t,a){return this.x*e+this.y*t+this.z*a},n);function n(e,t,a){this.x=e,this.y=t,this.z=a}var w=.5*(Math.sqrt(3)-1),M=(3-Math.sqrt(3))/6,z=new Array(512),_=new Array(512),o=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];!function(e){0<e&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var a=void 0;a=1&t?i[t]^255&e:i[t]^e>>8&255,z[t]=z[t+256]=a,_[t]=_[t+256]=o[a%12]}}(0),a.default=function(e,t){var a,r,n=(e+t)*w,o=Math.floor(e+n),i=Math.floor(t+n),u=(o+i)*M,l=e-o+u,s=t-i+u;r=s<l?(a=1,0):(a=0,1);var c=l-a+M,f=s-r+M,d=l-1+2*M,h=s-1+2*M,p=_[(o&=255)+z[i&=255]],v=_[o+a+z[i+r]],y=_[o+1+z[i+1]],g=.5-l*l-s*s,m=.5-c*c-f*f,x=.5-d*d-h*h;return 70*((g<0?0:(g*=g)*g*p.dot2(l,s))+(m<0?0:(m*=m)*m*v.dot2(c,f))+(x<0?0:(x*=x)*x*y.dot2(d,h)))}},{}],16:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createMesh=function(e,t,a,r){return void 0===a&&(a=16),void 0===r&&(r=32),e.wrapS=e.wrapT=THREE.RepeatWrapping,new THREE.Mesh(new THREE.SphereGeometry(t,r,a,0,2*Math.PI,0,Math.PI/2).rotateX(Math.PI/2).rotateZ(Math.PI),new THREE.MeshBasicMaterial({color:16777215,side:THREE.BackSide,map:e,fog:!1}))}},{}],17:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var h=e("./vec"),p=262144,v=1/6;function r(e){var t=Math.floor(Math.sqrt(p/6)),a=1/e.heightMapScale.x/t;return{cellSize:a,xCellCount:t,yCellCount:t,xSize:t*a,ySize:t*a,mesh:function(e){var t=Math.floor(Math.sqrt(p/6)),a=t,r=1/e.heightMapScale.x/t,n=e.textures;n.forEach(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=9});var o=e.heightMap;o.wrapS=o.wrapT=THREE.RepeatWrapping;var i=function(e,t,a){var r,n,o,i,u,l,s=new Float32Array(t*a*3),c=new Float32Array(t*a*2),f=0,d=0;for(n=0;n<a;++n)for(i=(n-a/2)*e,u=n,r=0;r<t;++r)o=(r-t/2)*e,l=r,s[f++]=o,s[f++]=i,s[f++]=4*Math.cos(+r)+4*Math.sin(+n),c[d++]=u*v,c[d++]=l*v;return{position:s,uv:c}}(r,t+1,a+1),u=function(e,t){var a,r=(e-1)*(t-1)*3*2;a=new(r<=65536?Uint16Array:Uint32Array)(r);var n,o,i=e-1,u=t-1;for(o=0;o<u;++o)for(n=0;n<i;++n){var l=6*(o*i+n);a[0+l]=(o+0)*e+(n+0),a[1+l]=(o+0)*e+(n+1),a[2+l]=(o+1)*e+(n+1),a[3+l]=(o+1)*e+(n+1),a[4+l]=(o+1)*e+(n+0),a[5+l]=(o+0)*e+(n+0)}return a}(t+1,a+1),l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(i.position,3)),l.addAttribute("uv",new THREE.BufferAttribute(i.uv,2)),l.setIndex(new THREE.BufferAttribute(u,1));var s=e.heightMapScale,c=e.fragScript.replace("%%TRANSITION_LOW%%",e.transitionLow.toString()).replace("%%TRANSITION_HIGH%%",e.transitionHigh.toString()),f=new THREE.RawShaderMaterial({uniforms:{offset:{type:"2f",value:[0,0]},uvOffset:{type:"2f",value:[0,0]},map1:{type:"t",value:n[0]},map2:{type:"t",value:n[1]},heightMap:{type:"t",value:o},heightMapScale:{type:"3f",value:[s.x,s.y,s.z]},fogColor:{type:"3f",value:h.Color.toArray(e.fogColor)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:e.fogFar},grassFogFar:{type:"f",value:e.grassFogFar}},vertexShader:e.vertScript,fragmentShader:c}),d=new THREE.Mesh(l,f);return d.frustumCulled=!1,d}(e)}}(r||(r={})).update=function(e,t,a){var r=Math.floor(t/e.cellSize),n=Math.floor(a/e.cellSize),o=r*e.cellSize,i=n*e.cellSize,u=e.mesh.material,l=u.uniforms.offset.value;l[0]=o,l[1]=i,(l=u.uniforms.uvOffset.value)[0]=n*v,l[1]=r*v},a.default=r},{"./vec":20}],18:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var v=e("./gmath"),y=e("./vec");a.createTexture=function(e,t,a){var r=document.createElement("canvas"),n=e.xCount+1,o=e.yCount+1;r.width=n,r.height=o;var i=r.getContext("2d"),u=i.getImageData(0,0,n,o);!function(e,t,a){for(var r=e.vtxNormals,n=e.xCount+1,o=e.yCount+1,i=y.Vec3.create(),u=Date.now(),l=0;l<o;++l)for(var s=0;s<n;++s){var c=l*n+s,f=(o-l-1)*n+s;a[4*f+0]=Math.round(e.heights[c]/e.maxHeight*255);var d=3*c;i.x=r[d++],i.y=r[d++],i.z=r[d++];var h=Math.max(-y.Vec3.dot(i,t),0);h*=m(e,t,s,l),a[4*f+1]=Math.round(255*h),a[4*f+3]=255}var p=Date.now()-u;console.log("computed terrain data texture ("+n+"x"+o+") values in "+p+"ms")}(e,t,u.data),function(e,t){var a=document.createElement("canvas"),r=e.naturalWidth,n=e.naturalHeight;a.width=r,a.height=n;var o=a.getContext("2d");o.drawImage(e,0,0);for(var i=o.getImageData(0,0,r,n).data,u=0;u<n;++u)for(var l=0;l<r;++l){var s=4*(u*r+l),c=i[s];t[2+s]=c}}(a,u.data),i.putImageData(u,0,0);var l=new THREE.Texture(r);return l.wrapS=l.wrapT=THREE.RepeatWrapping,l.needsUpdate=!0,l};var g=y.Vec2.create();function m(e,t,a,r){var n=g,o=e.xCount+1,i=e.yCount+1,u=r*o+a,l=e.heights[u];n.x=-t.x,n.y=-t.y,y.Vec2.normalize(n,n);for(var s=y.Vec2.length(n)/y.Vec2.length(t)*-t.z,c=a,f=r;l<e.maxHeight;){c+=n.x,f+=n.y,l+=s;var d=v.pmod(Math.round(c),o),h=v.pmod(Math.round(f),i),p=e.heights[h*o+d];if(l<p)return 5<p-l?.7:.7+.3*(5-(p-l))/5}return 1}},{"./gmath":6,"./vec":20}],19:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.$e=function(e){return document.getElementById(e)},a.$i=function(e){return document.getElementById(e)},a.detectWebGL=function(){try{var e=document.createElement("canvas");return!!e.getContext("webgl")||!!e.getContext("experimental-webgl")}catch(e){return null}}},{}],20:[function(e,t,a){"use strict";var r,n,o;function i(e,t){return{x:"number"==typeof e?e:0,y:"number"==typeof t?t:0}}function u(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function l(e,t,a){var r=u(e);0<r?(r=t/r,a.x=e.x*r,a.y=e.y*r):(a.x=t,a.y=0)}function s(e,t){return e.x*t.x+e.y*t.y}function c(e,t,a){return{x:"number"==typeof e?e:0,y:"number"==typeof t?t:0,z:"number"==typeof a?a:0}}function f(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}Object.defineProperty(a,"__esModule",{value:!0}),(r=a.Vec2||(a.Vec2={})).create=i,r.clone=function(e){return i(e.x,e.y)},r.set=function(e,t,a){e.x=t,e.y=a},r.copy=function(e,t){t.x=e.x,t.y=e.y},r.length=u,r.setLength=l,r.dist=function(e,t){var a=t.x-e.x,r=t.y-e.y;return Math.sqrt(a*a+r*r)},r.normalize=function(e,t){l(e,1,t)},r.dot=s,r.det=function(e,t){return e.x*t.y-e.y*t.x},r.rotate=function(e,t,a){var r=Math.cos(t),n=Math.sin(t),o=e.x,i=e.y;a.x=o*r-i*n,a.y=o*n+i*r},r.rotateCS=function(e,t,a,r){var n=e.x,o=e.y;r.x=n*t-o*a,r.y=n*a+o*t},r.reflect=function(e,t,a){var r=s(t,e);a.x=e.x-2*r*t.x,a.y=e.y-2*r*t.y},r.toArray=function(e){return[e.x,e.y]},(n=a.Vec3||(a.Vec3={})).create=c,n.clone=function(e){return c(e.x,e.y,e.z)},n.set=function(e,t,a,r){e.x=t,e.y=a,e.z=r},n.copy=function(e,t){t.x=e.x,t.y=e.y,t.z=e.z},n.length=f,n.setLength=function(e,t,a){var r=f(e);0<r?(r=t/r,a.x=e.x*r,a.y=e.y*r,a.z=e.z*r):(a.x=t,a.y=0,a.z=0)},n.dist=function(e,t){var a=t.x-e.x,r=t.y-e.y,n=t.z-e.z;return Math.sqrt(a*a+r*r+n*n)},n.normalize=function(e,t){n.setLength(e,1,t)},n.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},n.cross=function(e,t,a){var r=e.x,n=e.y,o=e.z,i=t.x,u=t.y,l=t.z;a.x=n*l-o*u,a.y=o*i-r*l,a.z=r*u-n*i},n.toArray=function(e){return[e.x,e.y,e.z]},(o=a.Color||(a.Color={})).create=function(e,t,a){return{r:"number"==typeof e?e:0,g:"number"==typeof t?t:0,b:"number"==typeof a?a:0}},o.toArray=function(e){return[e.r,e.g,e.b]},o.to24bit=function(e){return 255*e.r<<16^255*e.g<<8^255*e.b<<0}},{}],21:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("./vec"),n=0;a.createMesh=function(e){e.envMap.wrapS=e.envMap.wrapT=THREE.RepeatWrapping,e.envMap.minFilter=e.envMap.magFilter=THREE.LinearFilter,e.envMap.generateMipmaps=!1;var t=new THREE.RawShaderMaterial({uniforms:{time:{type:"1f",value:0},viewPos:{type:"3f",value:[0,0,10]},map:{type:"t",value:e.envMap},waterLevel:{type:"1f",value:e.waterLevel},waterColor:{type:"3f",value:r.Color.toArray(e.waterColor)},fogColor:{type:"3f",value:r.Color.toArray(e.fogColor)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:1.5*e.fogFar}},vertexShader:e.vertScript,fragmentShader:e.fragScript}),a=new THREE.Mesh(new THREE.PlaneBufferGeometry(2e3,2e3),t);return a.frustumCulled=!1,n=Date.now(),a},a.update=function(e,t){e.position.x=t.x,e.position.y=t.y;var a=e.material,r=a.uniforms.viewPos.value;r[0]=t.x,r[1]=t.y,r[2]=t.z,a.uniforms.time.value=(Date.now()-n)/250}},{"./vec":20}],22:[function(e,t,a){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});var F=e("./util"),H=e("./gmath"),A=e("./vec"),T=r(e("./logger")),R=r(e("./input")),V=r(e("./skydome")),P=r(e("./heightfield")),k=r(e("./grass")),I=n(e("./terrain")),O=r(e("./terramap")),$=r(e("./water")),L=n(e("./player")),j=n(e("./fps")),D=2e3,B=67,q=3072,N=180,W=.305556*N,G=.31,K=.36,U=A.Vec3.create(0,1,-1);A.Vec3.normalize(U,U);var Z=A.Color.create(.74,.77,.91),X=A.Color.create(.45,.46,.19),Y=A.Color.create(.6,.7,.85),Q=1.5,J=3,ee=.25,te=1.1,ae=1.5*Math.PI,re=.2,ne=A.Color.create(1,.8,.4),oe=2e3;a.default=function(e,t,s,a,r,n){var o=F.$e("app_canvas"),i=new THREE.WebGLRenderer({canvas:o,antialias:n,clearColor:16777215,clearAlpha:1,alpha:!0});if(!i)throw new Error("Failed to create THREE.WebGLRenderer");var u=20*s,l=2*s,c=new THREE.PerspectiveCamera(45,a/r,1,D),f={terrain:null,grass:null,sky:null,water:null,sunFlare:null,fade:null},d=new THREE.Scene;d.fog=new THREE.Fog(A.Color.to24bit(Z),.1,u),c.rotation.order="ZXY",c.rotation.x=.5*Math.PI,c.rotation.y=.5*Math.PI,c.rotation.z=Math.PI,c.up.set(0,0,1);var h=new THREE.Object3D;h.rotation.order="ZYX",h.add(c),d.add(h);var p=e.images.heightmap,v=q/p.width,y=A.Vec3.create(1/q,1/q,N),g=P.default({cellSize:v,minHeight:0,maxHeight:y.z,image:p});p=void 0;var m=O.createTexture(g,U,e.images.noise),x=Q;f.grass=k.createMesh({lightDir:U,numBlades:t,radius:s,texture:e.textures.grass,vertScript:e.text["grass.vert"],fragScript:e.text["grass.frag"],heightMap:m,heightMapScale:y,fogColor:Z,fogFar:u,grassFogFar:l,grassColor:X,transitionLow:G,transitionHigh:K,windIntensity:x}),f.grass.renderOrder=10,d.add(f.grass);var w=I.default({textures:[e.textures.terrain1,e.textures.terrain2],vertScript:e.text["terrain.vert"],fragScript:e.text["terrain.frag"],heightMap:m,heightMapScale:y,fogColor:Z,fogFar:u,grassFogFar:l,transitionLow:G,transitionHigh:K});f.terrain=w.mesh,f.terrain.renderOrder=20,d.add(f.terrain),f.sky=V.createMesh(e.textures.skydome,.95*D),f.sky.renderOrder=30,d.add(f.sky),f.sky.position.z=-25,f.water=$.createMesh({envMap:e.textures.skyenv,vertScript:e.text["water.vert"],fragScript:e.text["water.frag"],waterLevel:W,waterColor:Y,fogColor:Z,fogNear:1,fogFar:u}),f.water.renderOrder=40,d.add(f.water),f.water.position.z=W,f.fade=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,4,1,1),new THREE.MeshBasicMaterial({color:16777215,fog:!1,transparent:!0,opacity:1,depthTest:!1,depthWrite:!1})),f.fade.position.x=2,f.fade.rotation.y=1.5*Math.PI,f.fade.renderOrder=10,h.add(f.fade),h.renderOrder=100,f.sunFlare=new THREE.Mesh(new THREE.PlaneBufferGeometry(6,4,1,1),new THREE.MeshBasicMaterial({color:A.Color.to24bit(ne),fog:!1,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1,blending:THREE.AdditiveBlending})),f.sunFlare.position.x=2.05,f.sunFlare.rotation.y=1.5*Math.PI,f.sunFlare.visible=!1,f.sunFlare.renderOrder=20,h.add(f.sunFlare);var M=L.default(g,W),z=Date.now(),_=0;E(a,r),R.setKeyPressListener(192,function(){T.toggle()}),R.setKeyPressListener("O".charCodeAt(0),function(){M.state.pos.x=0,M.state.pos.y=0}),R.setKeyPressListener("F".charCodeAt(0),function(){x=Math.max(x-.1,0),f.grass.material.uniforms.windIntensity.value=x}),R.setKeyPressListener("G".charCodeAt(0),function(){x=Math.min(x+.1,J),f.grass.material.uniforms.windIntensity.value=x});var b=j.default();function E(e,t){a=e,r=t,i.setSize(a,r),c.aspect=a/r,c.updateProjectionMatrix()}var C=P.HInfo(),S=A.Vec2.create(0,0);return{doFrame:function(){var e=Date.now(),t=e-z;b.update(t),0<t&&(B<t&&(z=e-(t=B)),function(e){_<oe&&function(e){var t=f.fade.material;oe<=_+e?(t.opacity=0,f.fade.visible=!1):t.opacity=1-Math.pow(_/oe,2)}(e);var t=.001*(_+=e);M.update(e);var a=M.state.pos,r=M.state.dir,n=M.state.yaw,o=M.state.pitch,i=M.state.roll;P.default.infoAt(g,a.x,a.y,!0,C);var u=C.z;T.isVisible()&&T.setText("x:"+a.x.toFixed(4)+" y:"+a.y.toFixed(4)+" z:"+a.z.toFixed(4)+" dx:"+r.x.toFixed(4)+" dy:"+r.y.toFixed(4)+" dz:"+r.z.toFixed(4)+" height:"+u.toFixed(4)+" i:"+C.i+" fps:"+b.fps());f.sky.position.x=a.x,f.sky.position.y=a.y;var l=S;A.Vec2.set(l,a.x+Math.cos(n)*s,a.y+Math.sin(n)*s),k.update(f.grass,t,a,r,l),I.default.update(w,a.x,a.y),$.update(f.water,a),A.Vec3.copy(a,h.position),h.rotation.z=n,h.rotation.y=-o,h.rotation.x=i,function(){var e=Math.abs(H.difAngle(ae,M.state.yaw)),t=1.75*Math.abs(H.difAngle(re,M.state.pitch)),a=Math.sqrt(e*e+t*t);if(a<te){var r=ee*Math.pow((te-a)/(1+ee),.75);f.sunFlare.material.opacity=Math.max(0,r),f.sunFlare.visible=!0}else f.sunFlare.visible=!1}()}(t),i.render(d,c),z=e)},resize:E}}},{"./fps":4,"./gmath":6,"./grass":7,"./heightfield":8,"./input":9,"./logger":11,"./player":14,"./skydome":16,"./terrain":17,"./terramap":18,"./util":19,"./vec":20,"./water":21}]},{},[12]);